#!/usr/bin/env node

'use strict';

let fs = require('fs');
let pkg = require('../package.json');

let program = require('commander');
program
    .usage('[options] <task>')
    .version(pkg.version)
    .command('init [options] <repo>', 'init a repo')
    .option('-r, --report', 'build reports when test')
    .option('-s, --single-run', 'single run when test')
    .parse(process.argv);

let command = program.args[0];
if(!command)
    program.help();
else if(command === 'init') {
    return;
} else if(command === 'publish') {
    let version = program.args[1];
    if(!version)
        return console.log('Please input a version!');

    // 修改package.json

} else {    // run gulp
    if(!fs.existsSync(process.cwd() + '/package.json')) {
        console.error('error: Not a RGUI package');
        console.error('Please cd to a RGUI package directory or use `rgui-tools init` to create a new package.');
        return;
    }

    let gulp = require('gulp');
    let logEvents = require('../lib/logEvents.js');
    logEvents(gulp);
    gulp.program = program;

    // 分开引用，加快gulp启动速度
    if(command === 'dist')
        require('../gulp/dist/index.js');
    else if(command === 'test')
        require('../gulp/test/index.js');
    else
        require('../gulpfile.js');

    gulp.start(command);
}
